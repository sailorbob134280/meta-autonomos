# Raspberry Pi common configuration for AutonomOS
# Include this for all Raspberry Pi platforms, then include the machine-specific file.
header:
  version: 20

repos:
  meta-raspberrypi:
    url: "https://github.com/agherzan/meta-raspberrypi.git"
    path: "sources/meta-raspberrypi"

  meta-lts-mixins:
    url: https://git.yoctoproject.org/meta-lts-mixins
    # Workaround for U-Boot patch incompatibility with raspberrypi layer
    branch: scarthgap/u-boot
    path: "sources/meta-lts-mixins"

  meta-rauc-community:
    url: "https://github.com/rauc/meta-rauc-community.git"
    path: "sources/meta-rauc-community"
    branch: scarthgap
    layers:
      meta-rauc-raspberrypi:

  # Add the Raspberry Pi platform layer
  meta-autonomos:
    layers:
      meta-autonomos-raspberrypi:

local_conf_header:
  raspberrypi: |
    RPI_USE_U_BOOT = "1"
    ENABLE_UART = "1"
    MACHINE_FEATURES:append = " serial wifi bluetooth"
    IMAGE_INSTALL:append = " kernel-image kernel-devicetree packagegroup-autonomos-raspberrypi"
    IMAGE_FSTYPES:remove = " rpi-sdimg"
    LICENSE_FLAGS_ACCEPTED = "synaptics-killswitch"

  rauc-wks: |
    WKS_FILE = "autonomos-dual-raspberrypi.wks.in"
    IMAGE_FSTYPES:append = " wic wic.bz2 wic.bmap ext4"
